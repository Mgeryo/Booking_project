# Бронирование отелей
Это backend проект по аналогии с Booking.com, написанный на FastAPI, где используются SQLAlchemy, Redis, Celery, Docker и многие другие технологии и библиотеки.

## Запуск приложения
Для запуска FastAPI используется веб-сервер uvicorn. Команда для запуска:  
```
uvicorn app.main:app --reload
```  
Ее необходимо запускать в командной строке, обязательно находясь в корневой директории проекта.

Для просмотра документации FastAPI, где удобно сгруппированы и отображены все API эндпоинты добавьте `/docs` к адресной строке. Также здесь можно протестировать работу API.

### Celery & Flower
Для запуска Celery используется команда  
```
celery --app=app.tasks.celery:celery worker -l INFO -P solo
```
Запускается в отдельном терминале.
`-P solo`(или если не заработало используйте `--pool=gevent`) используется только на Windows, так как у Celery есть проблемы с работой на Windows.  
Для запуска Flower используется команда  
```
celery --app=app.tasks.celery:celery flower
``` 

### Docker compose
Для запуска приложения и всех сервисов (БД, Redis, веб-сервер (FastAPI), Celery, Flower) необходимо использовать файл docker-compose.yml и команды
```
docker compose build
docker compose up
```



---


### Регистрация и авторизация

Эндпоинт `/auth/register` отвечает за регистрацию нового пользователя. Принимает на вход `email` и `пароль`. Данные введеные пользователем валидируются с помощью pydantic схем. При успешном выполнении эндпоинта вернется _null_. Ваш email и захэшированный пароль добавятся в базу данных.

Эндпоинт `/auth/login` отвечает за аутентификацию пользователя. На вход также принимается `email` и `пароль`. При успешном ответе вернется _JWT токен_. Это означает, что пользователь найден в базе данных, email и пароль введены корректно, создан JWT токен и добавлена cookie. 

Эндпоинт `/auth/logout` отвечает за выход пользователя из системы. Происходит сгорание токена.

Эндпоинт `auth/me` отвечает за предоставление информации о пользователе, который в данный момент залогинен. На выход возвращает `id пользователя`, `email`, `захэширвоанный пароль`. 



### Бронирование

Эндпоинт `/bookings` по POST запросу добавляет новую бронь текущему пользователю. На вход принимаются `id комнаты`, `дата заезда` и `дата выезда`. Перед тем как добавить новую бронь, осуществляется проверка на наличие свободных комнат на конкретные даты введенные пользователем. При наличии свободных комнат информация занесется в базу данных и эндпоинт вернет эту информацию.

Эндпоинт `/bookings` по GET запросу выдает забронированные текущим пользователем комнаты в отелях. На вход ничего не принимается, на выходе отдается список из броней.

Эндпоинт `/bookings/{booking_id}` по DELETE запросу удаляет бронь. На вход принимает `id брони`. При успешном ответе возвращает _null_.


### Отели

Эндпоинт `/hotels/{location}` на вход принимает `локацию`, `время заезда` и `время выезда`, вовзращает список из отелей, где содержится информация по отелям, сервису, общему количеству комнат в этом отеле и оставшемуся количеству свободных комнат. 

Эндпоинт `/pages/hotels` работает аналогично предыдущему эндпоинту, но возвращает URL страницу с визуализацей отелей.git pull origin main